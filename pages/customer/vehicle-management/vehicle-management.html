<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8" />
    <title>Service Management - Vehicle Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#241358',
                    },
                },
            },
        };
    </script>
</head>


<body class="bg-gray-50 min-h-screen">
    <div id="sidebar-root"></div>
    <div id="navbar-root"></div>
    <main
        class="bg-gray-100 pt-24 sm:pt-6 px-2 sm:px-4 lg:ml-[250px] transition-all duration-300 min-h-screen overflow-y-auto"
        tabindex="0">


        <!-- Desktop View -->
        <section id="desktop-content" class="hidden sm:block">
            <h1 class="text-2xl font-bold mb-2 pb-8">Vehicles</h1>
            <div class="flex justify-between mb-6 relative">
                <div>
                    <button id="add-vehicle" class="p-4 outline-none shadow bg-white rounded ml-4">Add Vehicle</button>
                </div>
                <div class="flex items-center gap-2 w-full max-w-lg bg-white shadow rounded-lg px-3 py-2 relative">
                    <input type="text" id="searchInputDesktop" placeholder="Search vehicles..."
                        class="flex-grow outline-none border-none focus:ring-0 text-sm px-2" />
                    <button id="searchBtnDesktop" class="p-2 rounded-md hover:bg-gray-100" aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
                        </svg>
                    </button>
                    <button id="filterBtnDesktop" class="p-2 rounded-md hover:bg-gray-100"
                        aria-label="Toggle filter panel">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="w-5 h-5 text-gray-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h18M6 10h12M9 16h6M11 20h2" />
                        </svg>
                    </button>


                    <!-- Desktop Filter Panel -->
                    <div id="filterPanelDesktop"
                        class="hidden absolute top-14 right-0 z-50 bg-white rounded-xl shadow-2xl scale-105 animate-bounce-in px-6 py-4 transition-all duration-300 min-w-[300px]">
                        <h3 class="text-lg font-semibold mb-4">Filters</h3>
                        <label class="block mb-4">
                            <span class="text-sm block mb-1">Fuel</span>
                            <select id="filterFuelDesktop" class="w-full border rounded px-2 py-1">
                                <option value="">All</option>
                                <option value="Petrol">Petrol</option>
                                <option value="Diesel">Diesel</option>
                                <option value="EV">EV</option>
                                <option value="Hybrid">Hybrid</option>
                                <option value="CNG">CNG</option>
                            </select>
                        </label>
                        <label class="block mb-4">
                            <span class="text-sm block mb-1">Type</span>
                            <select id="filterTypeDesktop" class="w-full border rounded px-2 py-1">
                                <option value="">All</option>
                                <option value="two-wheeler">Two-Wheeler</option>
                                <option value="four-wheeler">Four-Wheeler</option>
                            </select>
                        </label>
                        <button id="applyFilterDesktop"
                            class="w-full mt-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Apply
                            Filter</button>
                    </div>
                </div>
            </div>


            <div class="flex justify-center p-10">
                <div class="overflow-x-auto w-full max-w-7xl">
                    <h2 class="text-xl font-semibold mb-2">Vehicle Info</h2>
                    <div class="flex justify-center">
                        <table
                            class="min-w-[1000px] w-full table-auto border border-gray-300 bg-white shadow-sm rounded-md">
                            <thead class="bg-gray-100 text-gray-700 text-sm">
                                <tr>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Vehicle No</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Brand</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Model</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Fuel</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Type</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Date Added</th>
                                    <th class="py-2 px-4 border border-gray-300 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vehicleTableBodyDesktop" class="text-sm"></tbody>
                        </table>
                    </div>

                    <div
                        class="flex justify-between items-center mt-4 text-sm text-gray-600 max-w-7xl mx-auto px-2 select-none">
                        <button id="prevPageDesktop" class="disabled:opacity-50" aria-label="Previous page">←
                            Previous</button>
                        <span id="pageInfoDesktop"></span>
                        <button id="nextPageDesktop" class="disabled:opacity-50" aria-label="Next page">Next
                            →</button>
                    </div>
                </div>
            </div>
        </section>


        <!-- Mobile View -->
        <section class="sm:hidden">
            <div class="relative mb-4 px-4 flex items-center gap-2">
                <div class="flex items-center w-full relative">
                    <input type="text" id="searchInputMobile"
                        class="w-full rounded-full px-4 pr-12 shadow-sm outline-none py-3"
                        placeholder="Search vehicles..." aria-label="Search vehicles" />
                    <button id="searchBtnMobile"
                        class="absolute right-2 top-[6px] bg-white rounded-full p-2 shadow hover:bg-gray-100"
                        aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
                        </svg>
                    </button>
                </div>

            </div>


            <div class="flex justify-end px-4 relative mb-4">
                <button id="filterBtnMobile" class="bg-white rounded-full p-2 shadow hover:bg-gray-100"
                    aria-label="Toggle filter mobile">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-600" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 4h18l-7 8v6l-4 2v-8z" />
                    </svg>
                </button>
                <div id="filterPanelMobile"
                    class="hidden absolute top-12 right-0 z-50 bg-white rounded-xl shadow-2xl scale-105 animate-bounce-in px-6 py-4 transition-all duration-300 min-w-[300px]">
                    <h3 class="text-lg font-semibold mb-4">Filters</h3>
                    <label class="block mb-4">
                        <span class="text-sm block mb-1">Fuel</span>
                        <select id="filterFuelMobile" class="w-full border rounded px-2 py-1">
                            <option value="">All</option>
                            <option value="Petrol">Petrol</option>
                            <option value="Diesel">Diesel</option>
                            <option value="EV">EV</option>
                            <option value="Hybrid">Hybrid</option>
                            <option value="CNG">CNG</option>
                        </select>
                    </label>
                    <label class="block mb-4">
                        <span class="text-sm block mb-1">Type</span>
                        <select id="filterTypeMobile" class="w-full border rounded px-2 py-1">
                            <option value="">All</option>
                            <option value="two-wheeler">Two-Wheeler</option>
                            <option value="four-wheeler">Four-Wheeler</option>
                        </select>
                    </label>
                    <button id="applyFilterMobile"
                        class="w-full mt-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">Apply
                        Filter</button>
                </div>
            </div>



            <div>
                <h2 class="text-lg font-semibold mb-2 px-4">Vehicle Info</h2>
                <div id="vehicleListMobile" class="p-2 space-y-3"></div>
                <div
                    class="flex justify-between items-center mt-4 text-sm text-gray-600 max-w-md mx-auto px-4 select-none">
                    <button id="prevPageMobile" class="disabled:opacity-50" aria-label="Previous page">←
                        Previous</button>
                    <span id="pageInfoMobile"></span>
                    <button id="nextPageMobile" class="disabled:opacity-50" aria-label="Next page">Next →</button>
                </div>
            </div>


            <!-- Mobile Modal -->
            <div id="vehicle-modal"
                class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-lg w-full max-w-md max-h-full flex flex-col overflow-hidden relative"
                    style="height: 100vh;">
                    <button id="modal-close-btn" aria-label="Close modal"
                        class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 focus:outline-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                    <div id="modal-content" class="p-6 overflow-auto flex-grow"></div>
                </div>
            </div>
        </section>


        <!-- Add Vehicle Modal (existing logic retained) -->
        <div id="add-vehicle-modal"
            class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md scrollbar-hide">
                <div class="flex justify-end">
                    <button onclick="closeVehicleAddModal()" class="px-2 py-1"><img src="/assets/cancel.png"
                            class="w-8 h-8" /></button>
                </div>
                <h3 class="text-lg font-medium mb-4 text-center">Add Vehicles</h3>
                <div>
                    <form>
                        <div class="p-2"><label class="font-medium block">Vehicle No: </label><input name="vehicle_no"
                                type="text" class="outline-gray-300 p-2 border border-gray-200 w-full" /></div>
                        <div class="p-2"><label class="font-medium block">Brand: </label><input name="brand" type="text"
                                class="outline-gray-300 p-2 border border-gray-200 w-full" /></div>
                        <div class="p-2"><label class="font-medium block">Model: </label><input name="model" type="text"
                                class="outline-gray-300 p-2 border border-gray-200 w-full" /></div>
                        <div class="p-2"><label class="font-medium block">Fuel: </label>
                            <div class="flex justify-between">
                                <div class="flex items-center"><input name="fuel" type="radio" value="Petrol"
                                        class="w-4 h-4 mr-2" /> Petrol
                                </div>
                                <div class="flex items-center"><input name="fuel" type="radio" value="Diesel"
                                        class="w-4 h-4 mr-2" /> Diesel
                                </div>
                                <div class="flex items-center"><input name="fuel" type="radio" value="EV"
                                        class="w-4 h-4 mr-2" /> EV</div>
                                <div class="flex items-center"><input name="fuel" type="radio" value="Hybrid"
                                        class="w-4 h-4 mr-2" /> Hybrid
                                </div>
                                <div class="flex items-center"><input name="fuel" type="radio" value="CNG"
                                        class="w-4 h-4 mr-2" /> CNG</div>
                            </div>
                        </div>
                        <div class="p-2"><label class="font-medium block">Type: </label>
                            <div class="flex">
                                <div class="flex items-center mr-10"><input name="type" type="radio" value="two-wheeler"
                                        class="w-4 h-4 mr-2" /> Two-Wheeler</div>
                                <div class="flex items-center"><input name="type" type="radio" value="four-wheeler"
                                        class="w-4 h-4 mr-2" />
                                    Four-Wheeler</div>
                            </div>
                        </div>
                        <div class="flex justify-between mt-4">
                            <div></div>
                            <button class="bg-primary text-white p-2" type="submit">Add</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="toastDesktop"
            class="hidden fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg">
            Vehicle Added Successfully
        </div>


        <!-- Universal Confirmation Modal -->
        <div id="confirmModal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white p-6 rounded shadow-lg max-w-xs w-full text-center">
                <p id="confirmText" class="mb-4"></p>
                <div class="flex justify-center space-x-2">
                    <button id="confirmYes" class="bg-primary text-white px-3 py-1 rounded">Yes</button>
                    <button id="confirmNo" class="bg-gray-200 text-gray-700 px-3 py-1 rounded">No</button>
                </div>
            </div>
        </div>


    </main>
    <script type="module" src="../../../components/user-components-loader.js"></script>
    <script>
        // Data and unified filtered list and selection
        const vehicles = [
            { vehicle_no: "TN 07 AB 1223", id: "V001", brand: "Toyota", model: "Camry", fuel: "Petrol", type: "four-wheeler", dateAdded: "2023-01-15", lastDeactivated: "", active: true },
            { vehicle_no: "TN 07 AB 1223", id: "V002", brand: "Honda", model: "CBR500R", fuel: "Petrol", type: "two-wheeler", dateAdded: "2023-05-20", lastDeactivated: "", active: true },
            { vehicle_no: "TN 07 AB 1223", id: "V003", brand: "Tesla", model: "Model 3", fuel: "EV", type: "four-wheeler", dateAdded: "2024-03-10", lastDeactivated: "2025-01-01", active: false },
            { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true },
            { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true }, { vehicle_no: "TN 07 AB 1223", id: "V004", brand: "Yamaha", model: "R15", fuel: "Petrol", type: "two-wheeler", dateAdded: "2022-11-05", lastDeactivated: "", active: true },
        ];


        let filteredVehicles = [...vehicles];
        let selected = [];


        // Elements references
        const tableBodyDesktop = document.getElementById("vehicleTableBodyDesktop");
        const selectAllDesktop = document.getElementById("selectAllDesktop");
        const prevBtnDesktop = document.getElementById("prevPageDesktop");
        const nextBtnDesktop = document.getElementById("nextPageDesktop");
        const pageInfoDesktop = document.getElementById("pageInfoDesktop");
        const searchInputDesktop = document.getElementById("searchInputDesktop");
        const searchBtnDesktop = document.getElementById("searchBtnDesktop");
        const filterFuelDesktop = document.getElementById("filterFuelDesktop");
        const filterTypeDesktop = document.getElementById("filterTypeDesktop");
        const filterBtnDesktop = document.getElementById("filterBtnDesktop");
        const filterPanelDesktop = document.getElementById("filterPanelDesktop");
        const applyFilterDesktop = document.getElementById("applyFilterDesktop");
        const batchActivateDesktop = document.getElementById("batchActivateDesktop");
        const batchDeactivateDesktop = document.getElementById("batchDeactivateDesktop");


        const vehicleListMobile = document.getElementById("vehicleListMobile");
        const prevBtnMobile = document.getElementById("prevPageMobile");
        const nextBtnMobile = document.getElementById("nextPageMobile");
        const pageInfoMobile = document.getElementById("pageInfoMobile");
        const searchInputMobile = document.getElementById("searchInputMobile");
        const searchBtnMobile = document.getElementById("searchBtnMobile");
        const batchActivateMobile = document.getElementById("batchActivateMobile");
        const batchDeactivateMobile = document.getElementById("batchDeactivateMobile");
        const filterBtnMobile = document.getElementById("filterBtnMobile");
        const filterPanelMobile = document.getElementById("filterPanelMobile");
        const applyFilterMobile = document.getElementById("applyFilterMobile");
        const filterFuelMobile = document.getElementById("filterFuelMobile");
        const filterTypeMobile = document.getElementById("filterTypeMobile");
        const selectAllFilteredData = document.getElementById("select-all-filtered-data");


        const confirmModal = document.getElementById("confirmModal");
        const confirmText = document.getElementById("confirmText");
        let confirmYes = document.getElementById("confirmYes");
        let confirmNo = document.getElementById("confirmNo");


        let currentPageDesktop = 1;
        const rowsPerPageDesktop = 5;
        let currentPageMobile = 1;
        const rowsPerPageMobile = 5;


        // --- RENDER functions unified ---


        function render() {
            renderTableDesktop();
            renderMobileListPaginated();

            updatePaginationDesktop();
            updatePaginationMobile();

        }


        function renderTableDesktop() {
            const start = (currentPageDesktop - 1) * rowsPerPageDesktop;
            const end = start + rowsPerPageDesktop;
            const pageData = filteredVehicles.slice(start, end);



            tableBodyDesktop.innerHTML = "";
            pageData.forEach((v, idx) => {
                const globalIdx = start + idx;
                const checked = selected.includes(globalIdx) ? "checked" : "";
                tableBodyDesktop.innerHTML += `
            <tr class="hover:bg-gray-50">
                <td class="py-2 px-4 border border-gray-300">${v.vehicle_no}</td>
                <td class="py-2 px-4 border border-gray-300">${v.brand}</td>
                <td class="py-2 px-4 border border-gray-300">${v.model}</td>
                <td class="py-2 px-4 border border-gray-300">${v.fuel}</td>
                <td class="py-2 px-4 border border-gray-300 capitalize">${v.type.replace("-", " ")}</td>
                <td class="py-2 px-4 border border-gray-300">${v.dateAdded}</td>
                <td class="py-2 px-4 border border-gray-300">
                <button class="toggleStateBtnDesktop text-white bg-red-500 p-2" data-index="${globalIdx}">
                    Delete
                </button>
                </td>
            </tr>
            `;
            });
            attachDesktopEvents();
        }


        function renderMobileListPaginated() {
            const start = (currentPageMobile - 1) * rowsPerPageMobile;
            const end = start + rowsPerPageMobile;
            const pageData = filteredVehicles.slice(start, end);


            vehicleListMobile.innerHTML = "";
            pageData.forEach((v, idx) => {
                const globalIdx = start + idx;
                const checked = selected.includes(globalIdx) ? "checked" : "";
                vehicleListMobile.innerHTML += `
            <div class="border-b border-gray-300 py-3 px-4 flex flex-col space-y-1">
                <div class="flex items-center mb-1">

                <div class="flex-1 ml-1.5">
                    <span class="font-semibold">${v.brand} ${v.model}</span><br>
                    <span class="text-xs text-gray-500 capitalize ml-0.5">${v.type.replace("-", " ")} | ${v.fuel}</span>
                </div>
                <button class="toggleStateBtnMobile text-sm ml-2  bg-red-500 text-white p-2" data-index="${globalIdx}">
                    Delete
                </button>
                </div>
                <div class="text-xs text-gray-600 pl-6">
                <span>Date Added: ${v.dateAdded}</span> 
                </div>
            </div>
            `;
            });
            attachMobileEvents();
        }


        // Attach events for desktop checkboxes and action buttons
        function attachDesktopEvents() {
            document.querySelectorAll(".toggleStateBtnDesktop").forEach(btn => {
                btn.addEventListener("click", function () {
                    const idx = parseInt(this.getAttribute("data-index"));
                    const v = filteredVehicles[idx];
                    showConfirmModal(
                        `Are you sure you want to delete ${v.brand} ${v.model}?`,
                        () => {
                            vehicles.pop(idx)
                            applyFilters();

                        }
                    );



                });
            });

        }


        // Attach events for mobile checkboxes and action buttons
        function attachMobileEvents() {

            document.querySelectorAll(".toggleStateBtnMobile").forEach(btn => {
                btn.addEventListener("click", function () {
                    const idx = parseInt(this.getAttribute("data-index"));
                    const v = filteredVehicles[idx];
                    console.log(idx)

                    showConfirmModal(
                        `Are you sure you want to delete ${v.brand} ${v.model}?`,
                        () => {
                            vehicles.pop(idx)
                            applyFilters();

                        }
                    );


                });
            });
        }


        // Pagination functions
        function updatePaginationDesktop() {
            const totalPages = Math.ceil(filteredVehicles.length / rowsPerPageDesktop);
            pageInfoDesktop.textContent = `Page ${currentPageDesktop} of ${totalPages}`;
            prevBtnDesktop.disabled = currentPageDesktop === 1;
            nextBtnDesktop.disabled = currentPageDesktop === totalPages || totalPages === 0;
        }
        prevBtnDesktop.addEventListener("click", () => {
            if (currentPageDesktop > 1) {
                currentPageDesktop--;
                render();
            }
        });
        nextBtnDesktop.addEventListener("click", () => {
            const totalPages = Math.ceil(filteredVehicles.length / rowsPerPageDesktop);
            if (currentPageDesktop < totalPages) {
                currentPageDesktop++;
                render();
            }
        });


        function updatePaginationMobile() {
            const totalPages = Math.ceil(filteredVehicles.length / rowsPerPageMobile);
            pageInfoMobile.textContent = `Page ${currentPageMobile} of ${totalPages}`;
            prevBtnMobile.disabled = currentPageMobile === 1;
            nextBtnMobile.disabled = currentPageMobile === totalPages || totalPages === 0;
        }
        prevBtnMobile.addEventListener("click", () => {
            if (currentPageMobile > 1) {
                currentPageMobile--;
                render();
            }
        });
        nextBtnMobile.addEventListener("click", () => {
            const totalPages = Math.ceil(filteredVehicles.length / rowsPerPageMobile);
            if (currentPageMobile < totalPages) {
                currentPageMobile++;
                render();
            }
        });


        // Search, filter and applyFilter unify
        searchBtnDesktop.addEventListener("click", () => {
            currentPageDesktop = 1;
            currentPageMobile = 1;
            applyFilters();
        });
        searchInputDesktop.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                currentPageDesktop = 1;
                currentPageMobile = 1;
                applyFilters();
            }
        });


        filterBtnDesktop.addEventListener("click", e => {
            e.stopPropagation();
            filterPanelDesktop.classList.toggle("hidden");
        });
        applyFilterDesktop.addEventListener("click", () => {
            filterPanelDesktop.classList.add("hidden");
            currentPageDesktop = 1;
            currentPageMobile = 1;
            applyFilters();
        });
        document.addEventListener("click", e => {
            if (!filterPanelDesktop.classList.contains("hidden") && !filterPanelDesktop.contains(e.target) && e.target.id !== "filterBtnDesktop") {
                filterPanelDesktop.classList.add("hidden");
            }
        });


        searchBtnMobile.addEventListener("click", () => {
            currentPageMobile = 1;
            currentPageDesktop = 1;
            applyFilters();
        });
        searchInputMobile.addEventListener("keydown", e => {
            if (e.key === "Enter") {
                currentPageMobile = 1;
                currentPageDesktop = 1;
                applyFilters();
            }
        });


        filterBtnMobile.addEventListener("click", e => {
            e.stopPropagation();
            filterPanelMobile.classList.toggle("hidden");
        });
        applyFilterMobile.addEventListener("click", () => {
            filterPanelMobile.classList.add("hidden");
            currentPageMobile = 1;
            currentPageDesktop = 1;
            applyFilters();
        });
        document.addEventListener("click", e => {
            if (!filterPanelMobile.classList.contains("hidden") && !filterPanelMobile.contains(e.target) && e.target !== filterBtnMobile) {
                filterPanelMobile.classList.add("hidden");
            }
        });


        function applyFilters() {
            const searchDesktop = searchInputDesktop.value.trim().toLowerCase();
            const fuelDesktop = filterFuelDesktop.value;
            const typeDesktop = filterTypeDesktop.value;
            const searchMobile = searchInputMobile.value.trim().toLowerCase();
            const fuelMobile = filterFuelMobile.value;
            const typeMobile = filterTypeMobile.value;


            // Filter union of desktop and mobile filter values to one filtered list
            filteredVehicles = vehicles.filter(v => {
                // Search match for desktop or mobile - unify with OR logic
                const searchMatch = (
                    v.brand.toLowerCase().includes(searchDesktop) ||
                    v.model.toLowerCase().includes(searchDesktop) ||
                    v.fuel.toLowerCase().includes(searchDesktop) ||
                    v.type.toLowerCase().includes(searchDesktop) ||
                    v.brand.toLowerCase().includes(searchMobile) ||
                    v.model.toLowerCase().includes(searchMobile) ||
                    v.fuel.toLowerCase().includes(searchMobile) ||
                    v.type.toLowerCase().includes(searchMobile)
                );
                // Fuel filters: desktop OR mobile, if either has a filter, it applies
                const fuelFilter = fuelDesktop || fuelMobile;
                const fuelMatch = fuelFilter === "" || v.fuel === fuelFilter;
                // Type filters: desktop OR mobile combined 
                const typeFilterActive = (typeDesktop !== "") || (typeMobile !== "");
                const typeMatch = !typeFilterActive || (v.type === typeDesktop) || (v.type === typeMobile);
                return searchMatch && fuelMatch && typeMatch;
            });
            // Clear invalid selections
            selected = selected.filter(i => i < filteredVehicles.length);
            render();
        }



        // Confirmation modal logic
        function showConfirmModal(msg, onYes) {
            confirmText.textContent = msg;
            confirmModal.classList.remove("hidden");
            let newYes = confirmYes.cloneNode(true);
            let newNo = confirmNo.cloneNode(true);
            confirmYes.replaceWith(newYes);
            confirmNo.replaceWith(newNo);
            confirmYes = newYes;
            confirmNo = newNo;
            confirmYes.onclick = () => {
                confirmModal.classList.add("hidden");
                if (typeof onYes === "function") onYes();
            };
            confirmNo.onclick = () => confirmModal.classList.add("hidden");
        }


        // Add Vehicle modal logic
        const add_vehicle_button = document.getElementById("add-vehicle");
        const vehicle_add_modal = document.getElementById("add-vehicle-modal");
        const toastDesktop = document.getElementById("toastDesktop");


        add_vehicle_button.addEventListener("click", () => {
            vehicle_add_modal.classList.remove("hidden");
        });
        function closeVehicleAddModal() {
            vehicle_add_modal.classList.add("hidden");
        }
        vehicle_add_modal.querySelector("form").addEventListener("submit", function (e) {
            e.preventDefault();
            const brand = this.brand.value.trim();
            const model = this.model.value.trim();
            const fuel = this.fuel.value;
            const type = this.type.value;
            vehicles.push({
                id: "V" + (vehicles.length + 1).toString().padStart(3, "0"),
                brand,
                model,
                fuel,
                type,
                dateAdded: new Date().toISOString().split("T")[0],
                lastDeactivated: "",
                active: true,
            });
            applyFilters();
            toastDesktop.classList.remove("hidden");
            setTimeout(() => toastDesktop.classList.add("hidden"), 3000);
            vehicle_add_modal.classList.add("hidden");
            this.reset();
        });



        // Initial render
        applyFilters();

        document.addEventListener('navbarLoaded', () => {
            const menu_actions = document.getElementById('menu_actions');

            menu_actions.addEventListener('click', (event) => {
                event.stopPropagation();

                let dropdown = document.getElementById('pageActionsDropdown');
                if (dropdown) {
                    dropdown.classList.toggle('hidden');
                    return;
                }

                dropdown = document.createElement('div');
                dropdown.id = 'pageActionsDropdown';
                dropdown.className = 'absolute right-0 mt-12 w-44 rounded-md shadow-lg bg-primary text-white ring-1 ring-black ring-opacity-5 z-50';

                dropdown.innerHTML = `
        <button id="add-vehicle-btn-mobile" class="block w-full text-left px-4 py-2 hover:bg-indigo-700 focus:outline-none" type="button">
            Add Vehicle
        </button>

        `;

                menu_actions.parentElement.appendChild(dropdown);

                document.getElementById('add-vehicle-btn-mobile').addEventListener('click', () => {
                    vehicle_add_modal.classList.remove('hidden')
                })

            });


            // Close dropdown if clicked outside
            document.addEventListener('click', () => {
                const dropdown = document.getElementById('pageActionsDropdown');
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            });




        });


    </script>


</body>


</html>