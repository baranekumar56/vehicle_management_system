<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Service Management - Vehicle Services</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#241358',
                    },
                },
            },
        };
    </script>
    <style>
        .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        /* Suggestion lists positioning */
        ul.suggestion-list {
          position: absolute;
          z-index: 60;
          background: white;
          border: 1px solid #cbd5e0; /* Tailwind gray-300 */
          border-radius: 0.375rem;
          max-height: 10rem;
          overflow-y: auto;
          width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

<!-- Sidebar and Navbar containers from vehicles.html -->
<div id="sidebar-root">

</div>

<div id="navbar-root">
  <!-- Navbar HTML copied from vehicles.html -->
  <div class="fixed top-0 left-0 right-0 h-16 bg-white shadow flex items-center px-4 z-50 border-b border-gray-200">
    <button id="mobileMenuBtn" class="lg:hidden mr-4 text-gray-600 hover:text-primary focus:outline-none" aria-label="Toggle sidebar">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <div class="flex flex-1 items-center max-w-4xl mx-auto relative">
      <input type="text" id="searchInputDesktop" placeholder="Search services..." 
             class="flex-grow border border-gray-300 rounded-l-lg px-3 py-2 text-sm focus:ring-1 focus:ring-primary focus:border-primary outline-none" />
      <button id="searchBtnDesktop" aria-label="Search" 
              class="bg-primary hover:bg-indigo-900 text-white px-3 rounded-r-lg flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="7"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
      <button id="filterBtnDesktop" class="p-2 rounded-md hover:bg-gray-100 absolute right-10 top-1/2 -translate-y-1/2" aria-label="Toggle filter panel">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
            stroke="currentColor" class="w-5 h-5 text-gray-600">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 4h18M6 10h12M9 16h6M11 20h2" />
        </svg>
      </button>

      <!-- Desktop Filter Panel -->
      <div id="filterPanelDesktop"
           class="hidden absolute top-14 right-0 z-50 bg-white rounded-xl shadow-2xl px-6 py-4 min-w-[320px] scale-105 animate-bounce-in transiton-all">
        <h3 class="text-lg font-semibold mb-4">Filters</h3>
        <form id="filterFormDesktop" class="space-y-4">
          <div>
            <label class="block mb-1 font-semibold" for="filterDateFromDesktop">Date Added From</label>
            <input type="date" id="filterDateFromDesktop" name="dateFrom" class="w-full border rounded px-2 py-1" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterDateToDesktop">Date Added To</label>
            <input type="date" id="filterDateToDesktop" name="dateTo" class="w-full border rounded px-2 py-1" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterPriceOpDesktop">Price Op</label>
            <select id="filterPriceOpDesktop" name="priceOp" class="w-full border rounded px-2 py-1">
              <option value="=">=</option>
              <option value=">=">≥</option>
              <option value="<=">≤</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterPriceDesktop">Price</label>
            <input type="number" min="0" step="0.01" id="filterPriceDesktop" name="price" class="w-full border rounded px-2 py-1" placeholder="Amount" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTimeOpDesktop">Time Op</label>
            <select id="filterTimeOpDesktop" name="timeOp" class="w-full border rounded px-2 py-1">
              <option value="=">=</option>
              <option value=">=">≥</option>
              <option value="<=">≤</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTimeDesktop">Time (min)</label>
            <input type="number" min="0" id="filterTimeDesktop" name="time" class="w-full border rounded px-2 py-1" placeholder="Minutes" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterFuelDesktop">Fuel</label>
            <select id="filterFuelDesktop" name="fuel" class="w-full border rounded px-2 py-1">
              <option value="">All</option>
              <option>Petrol</option>
              <option>Diesel</option>
              <option>EV</option>
              <option>Hybrid</option>
              <option>CNG</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTypeDesktop">Vehicle Type</label>
            <select id="filterTypeDesktop" name="type" class="w-full border rounded px-2 py-1">
              <option value="">All</option>
              <option value="two-wheeler">Two-Wheeler</option>
              <option value="four-wheeler">Four-Wheeler</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-primary text-white rounded py-2 hover:bg-indigo-900 transition">
            Apply Filter
          </button>
        </form>
      </div>
    </div>

    <div id="notifications" class="ml-6 relative">
      <button aria-label="Notifications" class="text-gray-600 hover:text-primary focus:outline-none relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8a6 6 0 10-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 01-3.46 0"></path>
        </svg>
        <span class="absolute top-0 right-0 block h-2 w-2 bg-red-600 rounded-full ring-2 ring-white"></span>
      </button>
    </div>
  </div>
</div>

<!-- Mobile Sidebar Overlay & Sidebar (copied style from vehicles.html) -->
<div id="mobileSidebarOverlay" class="fixed inset-0 bg-black opacity-40 hidden z-40"></div>
<div id="mobileSidebar" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg border-r border-gray-200 transform -translate-x-full transition-transform duration-300 z-50">
  <div class="p-4 font-bold text-xl border-b border-gray-200">Vehicle Services</div>
  <nav class="p-4 text-gray-700">
    <ul>
      <li class="mb-3"><a href="#" class="block py-2 px-4 hover:bg-primary hover:text-white rounded transition">Dashboard</a></li>
      <li class="mb-3"><a href="#" class="block py-2 px-4 hover:bg-primary hover:text-white rounded transition">All Services</a></li>
      <li class="mb-3"><a href="#" class="block py-2 px-4 hover:bg-primary hover:text-white rounded transition">Add Service</a></li>
      <li class="mb-3"><a href="#" class="block py-2 px-4 hover:bg-primary hover:text-white rounded transition">Settings</a></li>
    </ul>
  </nav>
</div>

<!-- Main Content -->
<main class="bg-gray-100 pt-24 sm:pt-6 px-4 sm:px-6 lg:ml-[250px] transition-all duration-300 min-h-screen overflow-y-auto" tabindex="0">

  <!-- Desktop vehicles section -->
  <section id="desktop-content" class="hidden sm:block max-w-7xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Vehicle Services</h1>

    <div class="flex justify-between gap-4 mb-6">
      <button id="openAddServiceModalBtn" class="py-3 px-5 bg-primary text-white rounded shadow hover:bg-indigo-900 transition">
        Add Service to Vehicle
      </button>

      <div class="flex gap-3">
        <button id="batchActivateDesktop" disabled class="bg-green-600 text-white px-4 py-2 rounded shadow disabled:opacity-50 hover:bg-green-700 transition">
          Batch Activate
        </button>
        <button id="batchDeactivateDesktop" disabled class="bg-red-600 text-white px-4 py-2 rounded shadow disabled:opacity-50 hover:bg-red-700 transition">
          Batch Deactivate
        </button>
      </div>
    </div>

    <!-- Services Table -->
    <div class="overflow-x-auto rounded border border-gray-300 bg-white shadow-sm">
      <table class="min-w-[1000px] w-full text-left text-sm border-collapse border border-gray-300">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border border-gray-300 p-2 text-center">
              <input type="checkbox" id="selectAllDesktop" aria-label="Select all services" />
            </th>
            <th class="border border-gray-300 p-2">Brand</th>
            <th class="border border-gray-300 p-2">Model</th>
            <th class="border border-gray-300 p-2">Fuel</th>
            <th class="border border-gray-300 p-2">Type</th>
            <th class="border border-gray-300 p-2">Service Name</th>
            <th class="border border-gray-300 p-2">Date Added</th>
            <th class="border border-gray-300 p-2">Last Date Deactivated</th>
            <th class="border border-gray-300 p-2">Price</th>
            <th class="border border-gray-300 p-2">Time to Complete (min)</th>
            <th class="border border-gray-300 p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="servicesTableBodyDesktop" class="bg-white"></tbody>
      </table>
    </div>
  </section>

  <!-- Mobile section -->
  <section class="sm:hidden px-4">
    <div class="mb-4 sticky top-20 z-30 bg-gray-100 p-3 rounded shadow flex flex-col gap-3">
      <div class="relative w-full flex items-center">
        <input type="text" id="searchInputMobile" placeholder="Search services..." aria-label="Search"
          class="w-full rounded-full px-4 pr-12 shadow-sm outline-none py-3 text-sm" />
        <button id="searchBtnMobile" aria-label="Search"
          class="absolute right-2 top-[6px] bg-white rounded-full p-2 shadow hover:bg-gray-100 transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
          </svg>
        </button>
      </div>
      <button id="filterBtnMobile" aria-label="Toggle filter mobile"
        class="bg-white rounded-full p-2 shadow hover:bg-gray-100 transition w-max self-end">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-600" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h18l-7 8v6l-4 2v-8z" />
        </svg>
      </button>
      <div id="filterPanelMobile"
        class="hidden bg-white rounded-xl shadow-2xl px-6 py-4 min-w-full scale-105 animate-bounce-in transiton-all">
        <h3 class="text-lg font-semibold mb-4">Filters</h3>
        <form id="filterFormMobile" class="space-y-4">
          <div>
            <label class="block mb-1 font-semibold" for="filterDateFromMobile">Date Added From</label>
            <input type="date" id="filterDateFromMobile" name="dateFrom" class="w-full border rounded px-2 py-1" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterDateToMobile">Date Added To</label>
            <input type="date" id="filterDateToMobile" name="dateTo" class="w-full border rounded px-2 py-1" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterPriceOpMobile">Price Op</label>
            <select id="filterPriceOpMobile" name="priceOp" class="w-full border rounded px-2 py-1">
              <option value="=">=</option>
              <option value=">=">≥</option>
              <option value="<=">≤</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterPriceMobile">Price</label>
            <input type="number" min="0" step="0.01" id="filterPriceMobile" name="price" class="w-full border rounded px-2 py-1" placeholder="Amount" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTimeOpMobile">Time Op</label>
            <select id="filterTimeOpMobile" name="timeOp" class="w-full border rounded px-2 py-1">
              <option value="=">=</option>
              <option value=">=">≥</option>
              <option value="<=">≤</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTimeMobile">Time (min)</label>
            <input type="number" min="0" id="filterTimeMobile" name="time" class="w-full border rounded px-2 py-1" placeholder="Minutes" />
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterFuelMobile">Fuel</label>
            <select id="filterFuelMobile" name="fuel" class="w-full border rounded px-2 py-1">
              <option value="">All</option>
              <option>Petrol</option>
              <option>Diesel</option>
              <option>EV</option>
              <option>Hybrid</option>
              <option>CNG</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="filterTypeMobile">Vehicle Type</label>
            <select id="filterTypeMobile" name="type" class="w-full border rounded px-2 py-1">
              <option value="">All</option>
              <option value="two-wheeler">Two-Wheeler</option>
              <option value="four-wheeler">Four-Wheeler</option>
            </select>
          </div>
          <button type="submit" class="w-full bg-primary text-white rounded py-2 hover:bg-indigo-900 transition">
            Apply Filter
          </button>
        </form>
      </div>
      <div class="flex space-x-3 mb-4">
        <button id="batchActivateMobile" disabled class="flex-grow bg-green-600 text-white px-4 py-2 rounded shadow disabled:opacity-50 hover:bg-green-700 transition text-sm">
          Batch Activate
        </button>
        <button id="batchDeactivateMobile" disabled class="flex-grow bg-red-600 text-white px-4 py-2 rounded shadow disabled:opacity-50 hover:bg-red-700 transition text-sm">
          Batch Deactivate
        </button>
      </div>

      <div id="servicesListMobile" class="space-y-4"></div>
    </section>
</main>

<!-- Universal Add Service to Vehicle Modal (styled like vehicles.html modals) -->
<div id="add-service-modal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden">
  <div role="dialog" aria-modal="true" aria-labelledby="addServiceTitle" tabindex="-1"
    class="bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto p-6 relative shadow-lg">
    <button id="closeAddServiceModal" aria-label="Close modal"
      class="absolute top-3 right-3 text-gray-600 hover:text-gray-900 text-3xl font-bold">&times;</button>
    <h2 id="addServiceTitle" class="text-2xl font-bold mb-6 text-center">Add Service to Vehicle</h2>

    <form id="addServiceForm" autocomplete="off" class="space-y-4">

      <div class="relative">
        <label for="brandInput" class="font-semibold block mb-1">Brand <span class="text-red-600">*</span></label>
        <input id="brandInput" name="brand" type="text" autocomplete="off"
          class="border border-gray-300 rounded w-full p-2"
          aria-autocomplete="list" aria-controls="brandSuggestionList" aria-haspopup="listbox" aria-expanded="false" />
        <ul id="brandSuggestionList" class="suggestion-list hidden" role="listbox"></ul>
        <p id="brandError" class="text-xs text-red-600 mt-1 hidden">Please choose a valid brand.</p>
      </div>

      <div>
        <label for="modelSelect" class="font-semibold block mb-1">Model <span class="text-red-600">*</span></label>
        <select id="modelSelect" name="model" disabled class="border border-gray-300 rounded w-full p-2">
          <option value="">Select brand first</option>
        </select>
        <p id="modelError" class="text-xs text-red-600 mt-1 hidden">Please select a model.</p>
      </div>

      <div>
        <label for="fuelSelect" class="font-semibold block mb-1">Fuel Type <span class="text-red-600">*</span></label>
        <select id="fuelSelect" name="fuel" disabled class="border border-gray-300 rounded w-full p-2">
          <option value="">Select fuel type</option>
          <option value="Petrol">Petrol</option>
          <option value="Diesel">Diesel</option>
          <option value="EV">EV</option>
          <option value="Hybrid">Hybrid</option>
          <option value="CNG">CNG</option>
        </select>
        <p id="fuelError" class="text-xs text-red-600 mt-1 hidden">Please select fuel type.</p>
      </div>

      <fieldset class="mb-2">
        <legend class="font-semibold mb-1">Vehicle Type <span class="text-red-600">*</span></legend>
        <div class="flex gap-6">
          <label class="inline-flex items-center">
            <input type="radio" name="vehicleType" value="two-wheeler" disabled />
            <span class="ml-2">Two-Wheeler</span>
          </label>
          <label class="inline-flex items-center">
            <input type="radio" name="vehicleType" value="four-wheeler" disabled />
            <span class="ml-2">Four-Wheeler</span>
          </label>
        </div>
        <p id="typeError" class="text-xs text-red-600 mt-1 hidden">Please select vehicle type.</p>
      </fieldset>

      <div class="relative">
        <label for="serviceNameInput" class="font-semibold block mb-1">Service Name <span class="text-red-600">*</span></label>
        <input id="serviceNameInput" name="serviceName" type="text" disabled autocomplete="off"
          class="border border-gray-300 rounded w-full p-2"
          aria-autocomplete="list" aria-controls="serviceSuggestionList" aria-haspopup="listbox" aria-expanded="false" />
        <ul id="serviceSuggestionList" class="suggestion-list hidden" role="listbox"></ul>
        <p id="serviceError" class="text-xs text-red-600 mt-1 hidden">Please enter a service name.</p>
      </div>

      <div>
        <label for="timeToCompleteInput" class="font-semibold block mb-1">Time to Complete (minutes) <span class="text-red-600">*</span></label>
        <input id="timeToCompleteInput" name="timeToComplete" type="number" min="1" disabled
          class="border border-gray-300 rounded w-full p-2" />
        <p id="timeError" class="text-xs text-red-600 mt-1 hidden">Please enter valid time.</p>
      </div>

      <div>
        <label for="priceInput" class="font-semibold block mb-1">Price <span class="text-red-600">*</span></label>
        <input id="priceInput" name="price" type="number" min="0" step="0.01" disabled
          class="border border-gray-300 rounded w-full p-2" />
        <p id="priceError" class="text-xs text-red-600 mt-1 hidden">Please enter valid price.</p>
      </div>

      <button type="submit" id="addServiceSubmitBtn" disabled
        class="w-full bg-primary hover:bg-indigo-900 text-white p-3 rounded font-semibold transition disabled:opacity-50">
        Add Service
      </button>

    </form>
  </div>
</div>

<!-- Toast -->
<div id="toast" role="alert" aria-live="assertive"
  class="fixed bottom-6 right-6 bg-green-600 text-white px-5 py-3 rounded opacity-0 pointer-events-none transition-opacity z-50"></div>

<script type="module" src="/components/components-loader.js"></script>
<script>
  (() => {
  // Initial services data
  let servicesData = [
    {
      id: 1, brand: "Honda", model: "Activa 6G", fuel: "Petrol", type: "two-wheeler",
      serviceName: "Oil Change", dateAdded: "2025-09-10", lastDeactivated: null,
      price: 300, timeToComplete: 30, active: true
    },
    {
      id: 2, brand: "Toyota", model: "Corolla", fuel: "Diesel", type: "four-wheeler",
      serviceName: "Wheel Alignment", dateAdded: "2025-08-15", lastDeactivated: "2025-09-05",
      price: 1200, timeToComplete: 60, active: false
    },
    {
      id: 3, brand: "Yamaha", model: "FZ", fuel: "Petrol", type: "two-wheeler",
      serviceName: "Brake Check", dateAdded: "2025-09-01", lastDeactivated: null,
      price: 200, timeToComplete: 20, active: true
    }
  ];

  const brands = ["Honda", "Yamaha", "TVS", "Suzuki", "Bajaj", "Hero", "Royal Enfield", "Toyota", "Hyundai", "Maruti"];
  const modelsByBrand = {
    "Honda": ["Activa 6G", "CB Shine", "CBR 150R"],
    "Yamaha": ["FZ", "R15", "FZ-FI"],
    "TVS": ["Apache", "Ntorq", "Jupiter"],
    "Suzuki": ["Access", "Gixxer", "Burgman"],
    "Bajaj": ["Pulsar", "Platina"],
    "Hero": ["Splendor", "Glamour"],
    "Royal Enfield": ["Bullet", "Classic 350"],
    "Toyota": ["Corolla", "Camry"],
    "Hyundai": ["i20", "Venue"],
    "Maruti": ["Swift", "Alto"]
  };
  const servicesByType = {
    "two-wheeler": [
      { name: "Oil Change", defaultTime: 30, defaultPrice: 300 },
      { name: "Chain Lubrication", defaultTime: 15, defaultPrice: 100 },
      { name: "Brake Check", defaultTime: 20, defaultPrice: 200 }
    ],
    "four-wheeler": [
      { name: "Oil Change", defaultTime: 45, defaultPrice: 800 },
      { name: "Wheel Alignment", defaultTime: 60, defaultPrice: 1200 },
      { name: "AC Service", defaultTime: 50, defaultPrice: 1500 }
    ]
  };

  let filteredServices = [...servicesData];
  let selectedServiceIds = new Set();

  // Sidebar toggle elements
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const mobileSidebar = document.getElementById('mobileSidebar');
  const mobileSidebarOverlay = document.getElementById('mobileSidebarOverlay');

  mobileMenuBtn.addEventListener('click', () => {
    mobileSidebar.classList.toggle('-translate-x-full');
    mobileSidebarOverlay.classList.toggle('hidden');
  });
  mobileSidebarOverlay.addEventListener('click', () => {
    mobileSidebar.classList.add('-translate-x-full');
    mobileSidebarOverlay.classList.add('hidden');
  });

  // Navbar elements
  const filterBtnDesktop = document.getElementById('filterBtnDesktop');
  const filterPanelDesktop = document.getElementById('filterPanelDesktop');

  const filterBtnMobile = document.getElementById('filterBtnMobile');
  const filterPanelMobile = document.getElementById('filterPanelMobile');

  const filterFormDesktop = document.getElementById('filterFormDesktop');
  const filterFormMobile = document.getElementById('filterFormMobile');

  const searchInputDesktop = document.getElementById('searchInputDesktop');
  const searchBtnDesktop = document.getElementById('searchBtnDesktop');

  const searchInputMobile = document.getElementById('searchInputMobile');
  const searchBtnMobile = document.getElementById('searchBtnMobile');

  // Batch buttons
  const batchActivateDesktop = document.getElementById('batchActivateDesktop');
  const batchDeactivateDesktop = document.getElementById('batchDeactivateDesktop');
  const batchActivateMobile = document.getElementById('batchActivateMobile');
  const batchDeactivateMobile = document.getElementById('batchDeactivateMobile');

  // Service table elements
  const selectAllDesktop = document.getElementById('selectAllDesktop');
  const servicesTableBodyDesktop = document.getElementById('servicesTableBodyDesktop');

  const servicesListMobile = document.getElementById('servicesListMobile');

  // Modal elements
  const openAddServiceModalBtn = document.getElementById('openAddServiceModalBtn');
  const addServiceModal = document.getElementById('add-service-modal');
  const closeAddServiceModal = document.getElementById('closeAddServiceModal');
  const addServiceForm = document.getElementById('addServiceForm');

  const brandInput = document.getElementById('brandInput');
  const brandSuggestionList = document.getElementById('brandSuggestionList');
  const brandError = document.getElementById('brandError');

  const modelSelect = document.getElementById('modelSelect');
  const modelError = document.getElementById('modelError');

  const fuelSelect = document.getElementById('fuelSelect');
  const fuelError = document.getElementById('fuelError');

  const typeRadios = Array.from(document.querySelectorAll('input[name="vehicleType"]'));
  const typeError = document.getElementById('typeError');

  const serviceNameInput = document.getElementById('serviceNameInput');
  const serviceSuggestionList = document.getElementById('serviceSuggestionList');
  const serviceError = document.getElementById('serviceError');

  const timeInput = document.getElementById('timeToCompleteInput');
  const timeError = document.getElementById('timeError');

  const priceInput = document.getElementById('priceInput');
  const priceError = document.getElementById('priceError');

  const submitBtn = document.getElementById('addServiceSubmitBtn');

  const toast = document.getElementById('toast');

  // Toast helper
  function showToast(message, success = true) {
    toast.textContent = message;
    toast.classList.remove('opacity-0');
    toast.classList.add('opacity-100');
    toast.style.backgroundColor = success ? '#16a34a' : '#dc2626';
    setTimeout(() => {
      toast.classList.remove('opacity-100');
      toast.classList.add('opacity-0');
    }, 3000);
  }

  // Modal open/close
  openAddServiceModalBtn.addEventListener('click', () => {
    resetModalForm();
    addServiceModal.classList.remove('hidden');
    brandInput.focus();
  });
  closeAddServiceModal.addEventListener('click', () => {
    addServiceModal.classList.add('hidden');
  });
  window.addEventListener('click', e => {
    if (e.target === addServiceModal) {
      addServiceModal.classList.add('hidden');
    }
  });

  // Reset modal form inputs and disable dependent inputs
  function resetModalForm() {
    addServiceForm.reset();
    brandError.classList.add('hidden');
    modelError.classList.add('hidden');
    fuelError.classList.add('hidden');
    typeError.classList.add('hidden');
    serviceError.classList.add('hidden');
    timeError.classList.add('hidden');
    priceError.classList.add('hidden');

    brandSuggestionList.innerHTML = '';
    brandSuggestionList.classList.add('hidden');

    serviceSuggestionList.innerHTML = '';
    serviceSuggestionList.classList.add('hidden');

    modelSelect.innerHTML = '<option value="">Select brand first</option>';
    modelSelect.disabled = true;
    fuelSelect.disabled = true;
    disableVehicleType();
    disableServiceNameInput();
    disableTimePriceInputs();
    submitBtn.disabled = true;
  }

  // Helper enable/disable methods for modal controls
  function populateModelSelect(brand) {
    const models = modelsByBrand[brand] || [];
    modelSelect.innerHTML = '';
    if (models.length === 0) {
      modelSelect.innerHTML = '<option value="">No models available</option>';
      modelSelect.disabled = true;
    } else {
      modelSelect.innerHTML = '<option value="">Select model</option>';
      models.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m;
        opt.textContent = m;
        modelSelect.appendChild(opt);
      });
      modelSelect.disabled = false;
    }
  }
  function enableFuelSelect() { fuelSelect.disabled = false; }
  function disableFuelSelect() {
    fuelSelect.value = '';
    fuelSelect.disabled = true;
  }
  function disableVehicleType() {
    typeRadios.forEach(r => {
      r.checked = false;
      r.disabled = true;
    });
  }
  function enableVehicleType() {
    typeRadios.forEach(r => r.disabled = false);
  }
  function disableServiceNameInput() {
    serviceNameInput.value = '';
    serviceNameInput.disabled = true;
    serviceSuggestionList.innerHTML = '';
    serviceSuggestionList.classList.add('hidden');
  }
  function enableServiceNameInput() {
    serviceNameInput.disabled = false;
  }
  function disableTimePriceInputs() {
    timeInput.value = '';
    priceInput.value = '';
    timeInput.disabled = true;
    priceInput.disabled = true;
  }
  function enableTimePriceInputs() {
    timeInput.disabled = false;
    priceInput.disabled = false;
  }

  // Validation functions
  function validateBrand() {
    const val = brandInput.value.trim();
    if (!brands.includes(val)) {
      brandError.classList.remove('hidden');
      return false;
    }
    brandError.classList.add('hidden');
    return true;
  }
  function validateModel() {
    if (!modelSelect.value) {
      modelError.classList.remove('hidden');
      return false;
    }
    modelError.classList.add('hidden');
    return true;
  }
  function validateFuel() {
    if (!fuelSelect.value) {
      fuelError.classList.remove('hidden');
      return false;
    }
    fuelError.classList.add('hidden');
    return true;
  }
  function validateType() {
    const val = typeRadios.find(r => r.checked);
    if (!val) {
      typeError.classList.remove('hidden');
      return false;
    }
    typeError.classList.add('hidden');
    return true;
  }
  function validateServiceName() {
    const val = serviceNameInput.value.trim();
    if (!val) {
      serviceError.classList.remove('hidden');
      return false;
    }
    serviceError.classList.add('hidden');
    return true;
  }
  function validateTime() {
    const val = Number(timeInput.value);
    if (!val || val <= 0) {
      timeError.classList.remove('hidden');
      return false;
    }
    timeError.classList.add('hidden');
    return true;
  }
  function validatePrice() {
    const val = Number(priceInput.value);
    if (isNaN(val) || val < 0) {
      priceError.classList.remove('hidden');
      return false;
    }
    priceError.classList.add('hidden');
    return true;
  }

  // Overall form validation and submit button toggle
  function validateForm() {
    const valid = validateBrand() && validateModel() && validateFuel() && validateType() &&
      validateServiceName() && validateTime() && validatePrice();
    submitBtn.disabled = !valid;
    return valid;
  }

  // Brand input autocomplete
  brandInput.addEventListener('input', () => {
    const val = brandInput.value.trim().toLowerCase();
    if (!val) {
      brandSuggestionList.innerHTML = '';
      brandSuggestionList.classList.add('hidden');
      modelSelect.disabled = true;
      modelSelect.innerHTML = '<option value="">Select brand first</option>';
      disableFuelSelect();
      disableVehicleType();
      disableServiceNameInput();
      disableTimePriceInputs();
      validateForm();
      return;
    }
    const filtered = brands.filter(b => b.toLowerCase().includes(val));
    if (filtered.length === 0) {
      brandSuggestionList.classList.add('hidden');
    } else {
      brandSuggestionList.innerHTML = '';
      filtered.forEach(b => {
        const li = document.createElement('li');
        li.setAttribute('role', 'option');
        li.className = 'cursor-pointer px-3 py-2 hover:bg-indigo-100';
        li.textContent = b;
        li.tabIndex = 0;
        li.addEventListener('mousedown', e => {
          e.preventDefault();
          brandInput.value = b;
          brandSuggestionList.classList.add('hidden');
          populateModelSelect(b);
          enableFuelSelect();
          disableVehicleType();
          disableServiceNameInput();
          disableTimePriceInputs();
          validateForm();
          modelSelect.focus();
        });
        brandSuggestionList.appendChild(li);
      });
      brandSuggestionList.classList.remove('hidden');
    }
  });
  brandInput.addEventListener('blur', () => {
    setTimeout(() => brandSuggestionList.classList.add('hidden'), 100);
    validateBrand();
  });

  modelSelect.addEventListener('change', () => {
    if (modelSelect.value) {
      enableFuelSelect();
    } else {
      disableFuelSelect();
      disableVehicleType();
      disableServiceNameInput();
      disableTimePriceInputs();
    }
    validateModel();
    validateForm();
  });

  fuelSelect.addEventListener('change', () => {
    if (fuelSelect.value) {
      enableVehicleType();
    } else {
      disableVehicleType();
      disableServiceNameInput();
      disableTimePriceInputs();
    }
    validateFuel();
    validateForm();
  });

  // Vehicle type radio change
  typeRadios.forEach(radio => {
    radio.addEventListener('change', () => {
      if (validateType()) {
        enableServiceNameInput();
        enableTimePriceInputs();
        populateServiceSuggestions();
      } else {
        disableServiceNameInput();
        disableTimePriceInputs();
      }
      validateForm();
    });
  });

  // Service name autocomplete
  serviceNameInput.addEventListener('input', () => {
    const val = serviceNameInput.value.trim().toLowerCase();
    const selectedType = typeRadios.find(r => r.checked)?.value;
    if (!val || !selectedType) {
      serviceSuggestionList.innerHTML = '';
      serviceSuggestionList.classList.add('hidden');
      validateForm();
      return;
    }
    const names = servicesByType[selectedType].map(s => s.name);
    const filtered = names.filter(n => n.toLowerCase().includes(val));
    if (filtered.length === 0) {
      serviceSuggestionList.classList.add('hidden');
    } else {
      serviceSuggestionList.innerHTML = '';
      filtered.forEach(name => {
        const li = document.createElement('li');
        li.setAttribute('role', 'option');
        li.className = 'cursor-pointer px-3 py-2 hover:bg-indigo-100';
        li.textContent = name;
        li.tabIndex = 0;
        li.addEventListener('mousedown', e => {
          e.preventDefault();
          serviceNameInput.value = name;
          serviceSuggestionList.classList.add('hidden');
          const matched = servicesByType[selectedType].find(s => s.name === name);
          timeInput.value = matched?.defaultTime || '';
          priceInput.value = matched?.defaultPrice || '';
          validateForm();
        });
        serviceSuggestionList.appendChild(li);
      });
      serviceSuggestionList.classList.remove('hidden');
    }
    validateForm();
  });
  serviceNameInput.addEventListener('blur', () => {
    setTimeout(() => serviceSuggestionList.classList.add('hidden'), 100);
    validateServiceName();
  });

  // Populate service suggestions from all services under selected vehicle type
  function populateServiceSuggestions() {
    const selectedType = typeRadios.find(r => r.checked)?.value;
    if (!selectedType) return;
    serviceSuggestionList.innerHTML = '';
    servicesByType[selectedType].forEach(s => {
      const li = document.createElement('li');
      li.setAttribute('role', 'option');
      li.className = 'cursor-pointer px-3 py-2 hover:bg-indigo-100';
      li.textContent = s.name;
      li.tabIndex = 0;
      li.addEventListener('mousedown', e => {
        e.preventDefault();
        serviceNameInput.value = s.name;
        timeInput.value = s.defaultTime;
        priceInput.value = s.defaultPrice;
        serviceSuggestionList.classList.add('hidden');
        validateForm();
      });
      serviceSuggestionList.appendChild(li);
    });
  }

  // Time & Price input validation on input
  [timeInput, priceInput].forEach(input => {
    input.addEventListener('input', () => {
      validateTime();
      validatePrice();
      validateForm();
    });
  });

  // Add Service form submit
  addServiceForm.addEventListener('submit', e => {
    e.preventDefault();
    if (!validateForm()) return;

    const newService = {
      id: servicesData.length ? servicesData[servicesData.length - 1].id + 1 : 1,
      brand: brandInput.value.trim(),
      model: modelSelect.value,
      fuel: fuelSelect.value,
      type: typeRadios.find(r => r.checked).value,
      serviceName: serviceNameInput.value.trim(),
      dateAdded: new Date().toISOString().slice(0, 10),
      lastDeactivated: null,
      price: parseFloat(priceInput.value),
      timeToComplete: parseInt(timeInput.value, 10),
      active: true
    };
    servicesData.push(newService);
    filteredServices = [...servicesData];
    selectedServiceIds.clear();

    renderAll();
    showToast(`Service added to vehicle ${newService.model}`);

    addServiceModal.classList.add('hidden');
  });

  // Render both desktop and mobile views
  function renderAll() {
    renderDesktopTable();
    renderMobileList();
    updateBatchButtons();
    updateSelectAllCheckbox();
  }

  // Desktop table render
  function renderDesktopTable() {
    servicesTableBodyDesktop.innerHTML = '';
    if (filteredServices.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 11;
      td.className = 'text-center p-4 text-gray-500';
      td.textContent = 'No services found.';
      tr.appendChild(td);
      servicesTableBodyDesktop.appendChild(tr);
      return;
    }
    filteredServices.forEach(service => {
      const tr = document.createElement('tr');

      // Checkbox
      const tdCheck = document.createElement('td');
      tdCheck.className = 'border border-gray-300 p-2 text-center';
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = selectedServiceIds.has(service.id);
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) selectedServiceIds.add(service.id);
        else selectedServiceIds.delete(service.id);
        updateBatchButtons();
        updateSelectAllCheckbox();
        renderMobileList();
      });
      tdCheck.appendChild(checkbox);
      tr.appendChild(tdCheck);

      // Brand
      tr.appendChild(createTd(service.brand));
      // Model
      tr.appendChild(createTd(service.model));
      // Fuel
      tr.appendChild(createTd(service.fuel));
      // Type
      tr.appendChild(createTd(service.type === 'two-wheeler' ? 'Two-Wheeler' : 'Four-Wheeler'));
      // Service Name
      tr.appendChild(createTd(service.serviceName));
      // Date Added
      tr.appendChild(createTd(service.dateAdded));
      // Last Date Deactivated
      tr.appendChild(createTd(service.lastDeactivated || '-'));

      // Price editable
      const tdPrice = document.createElement('td');
      tdPrice.className = 'border border-gray-300 p-2';

      const priceInputEl = document.createElement('input');
      priceInputEl.type = 'number';
      priceInputEl.value = service.price.toFixed(2);
      priceInputEl.min = 0;
      priceInputEl.step = '0.01';
      priceInputEl.className = 'w-full border rounded px-2 py-1 text-sm';

      tdPrice.appendChild(priceInputEl);
      tr.appendChild(tdPrice);

      // Time to Complete editable
      const tdTime = document.createElement('td');
      tdTime.className = 'border border-gray-300 p-2';

      const timeInputEl = document.createElement('input');
      timeInputEl.type = 'number';
      timeInputEl.value = service.timeToComplete;
      timeInputEl.min = 1;
      timeInputEl.step = '1';
      timeInputEl.className = 'w-full border rounded px-2 py-1 text-sm';

      tdTime.appendChild(timeInputEl);
      tr.appendChild(tdTime);

      // Actions (Save, Deactivate/Activate)
      const tdActions = document.createElement('td');
      tdActions.className = 'border border-gray-300 p-2 flex gap-2';

      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'Save';
      saveBtn.disabled = true;
      saveBtn.className = 'bg-primary hover:bg-indigo-900 text-white px-3 py-1 rounded disabled:opacity-50 transition';

      // Enable save button on input change
      priceInputEl.addEventListener('input', () => saveBtn.disabled = false);
      timeInputEl.addEventListener('input', () => saveBtn.disabled = false);

      saveBtn.addEventListener('click', () => {
        const newPrice = parseFloat(priceInputEl.value);
        const newTime = parseInt(timeInputEl.value, 10);
        if (isNaN(newPrice) || newPrice < 0) return showToast('Invalid price entered', false);
        if (isNaN(newTime) || newTime < 1) return showToast('Invalid time entered', false);

        service.price = newPrice;
        service.timeToComplete = newTime;
        showToast(`Service price/time updated for ${service.model}`);
        saveBtn.disabled = true;
        renderAll();
      });

      tdActions.appendChild(saveBtn);

      const deactivateBtn = document.createElement('button');
      deactivateBtn.textContent = service.active ? 'Deactivate' : 'Activate';
      deactivateBtn.className = service.active
        ? 'bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded'
        : 'bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded';

      deactivateBtn.addEventListener('click', () => {
        service.active = !service.active;
        service.lastDeactivated = service.active ? null : new Date().toISOString().slice(0, 10);
        showToast(service.active ? `Service activated for ${service.model}` : `Service deactivated for ${service.model}`);
        renderAll();
      });

      tdActions.appendChild(deactivateBtn);
      tr.appendChild(tdActions);

      servicesTableBodyDesktop.appendChild(tr);
    });
  }

  // Mobile list render
  function renderMobileList() {
    servicesListMobile.innerHTML = '';
    if (filteredServices.length === 0) {
      const p = document.createElement('p');
      p.className = 'text-center text-gray-500 py-8';
      p.textContent = 'No services found.';
      servicesListMobile.appendChild(p);
      return;
    }
    filteredServices.forEach(service => {
      const div = document.createElement('div');
      div.className = 'bg-white shadow rounded p-4 flex flex-col gap-2 border border-gray-300';

      // Header with checkbox and service name
      const header = document.createElement('div');
      header.className = 'flex items-center justify-between';

      const label = document.createElement('label');
      label.className = 'inline-flex items-center gap-2';
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = selectedServiceIds.has(service.id);
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) selectedServiceIds.add(service.id);
        else selectedServiceIds.delete(service.id);
        updateBatchButtons();
        updateSelectAllCheckbox();
        renderDesktopTable();
      });
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(service.serviceName));
      header.appendChild(label);

      div.appendChild(header);

      // Details list
      const ul = document.createElement('ul');
      ul.className = 'text-sm text-gray-600 grid grid-cols-2 gap-2 mt-2';

      [['Brand', service.brand],
       ['Model', service.model],
       ['Fuel', service.fuel],
       ['Type', service.type === 'two-wheeler' ? 'Two-Wheeler' : 'Four-Wheeler'],
       ['Date Added', service.dateAdded],
       ['Last Deactivated', service.lastDeactivated ?? '-'],
       ['Price', service.price.toFixed(2)],
       ['Time (min)', service.timeToComplete],
       ['Status', service.active ? 'Active' : 'Inactive']].forEach(([k,v]) => {
        const li = document.createElement('li');
        li.className = 'flex gap-1';
        li.innerHTML = `<b>${k}:</b> ${v}`;
        ul.appendChild(li);
      });

      div.appendChild(ul);

      // Actions (activate/deactivate)
      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'mt-3 flex gap-3';

      const actBtn = document.createElement('button');
      actBtn.textContent = service.active ? 'Deactivate' : 'Activate';
      actBtn.className = service.active
        ? 'flex-grow bg-red-600 text-white py-2 rounded shadow hover:bg-red-700 transition text-sm'
        : 'flex-grow bg-green-600 text-white py-2 rounded shadow hover:bg-green-700 transition text-sm';

      actBtn.addEventListener('click', () => {
        service.active = !service.active;
        service.lastDeactivated = service.active ? null : new Date().toISOString().slice(0, 10);
        showToast(service.active ? `Service activated for ${service.model}` : `Service deactivated for ${service.model}`);
        renderAll();
      });

      actionsDiv.appendChild(actBtn);
      div.appendChild(actionsDiv);

      servicesListMobile.appendChild(div);
    });
  }

  // Create standard td with text
  function createTd(text) {
    const td = document.createElement('td');
    td.className = 'border border-gray-300 p-2';
    td.textContent = text;
    return td;
  }

  // Select all change desktop checkbox
  selectAllDesktop.addEventListener('change', () => {
    if (selectAllDesktop.checked)
      filteredServices.forEach(s => selectedServiceIds.add(s.id));
    else
      filteredServices.forEach(s => selectedServiceIds.delete(s.id));
    renderAll();
  });

  // Update select all checkbox state based on selections
  function updateSelectAllCheckbox() {
    if (filteredServices.length === 0) {
      selectAllDesktop.checked = false;
      return;
    }
    selectAllDesktop.checked = filteredServices.every(s => selectedServiceIds.has(s.id));
  }

  // Update batch buttons enabled state
  function updateBatchButtons() {
    const anySelected = selectedServiceIds.size > 0;
    batchActivateDesktop.disabled = !anySelected;
    batchDeactivateDesktop.disabled = !anySelected;
    batchActivateMobile.disabled = !anySelected;
    batchDeactivateMobile.disabled = !anySelected;
  }

  // Batch activate / deactivate functions
  batchActivateDesktop.addEventListener('click', () => batchActivate());
  batchActivateMobile.addEventListener('click', () => batchActivate());
  batchDeactivateDesktop.addEventListener('click', () => batchDeactivate());
  batchDeactivateMobile.addEventListener('click', () => batchDeactivate());

  function batchActivate() {
    selectedServiceIds.forEach(id => {
      const s = servicesData.find(service => service.id === id);
      if (s && !s.active) {
        s.active = true;
        s.lastDeactivated = null;
      }
    });
    showToast('Selected services activated');
    selectedServiceIds.clear();
    applyFiltersAndRender();
  }
  function batchDeactivate() {
    const today = new Date().toISOString().slice(0, 10);
    selectedServiceIds.forEach(id => {
      const s = servicesData.find(service => service.id === id);
      if (s && s.active) {
        s.active = false;
        s.lastDeactivated = today;
      }
    });
    showToast('Selected services deactivated');
    selectedServiceIds.clear();
    applyFiltersAndRender();
  }

  // Filter form handlers
  filterFormDesktop.addEventListener('submit', e => {
    e.preventDefault();
    syncFilterForms(filterFormDesktop, filterFormMobile);
    applyFiltersAndRender();
    filterPanelDesktop.classList.add('hidden');
  });

  filterFormMobile.addEventListener('submit', e => {
    e.preventDefault();
    syncFilterForms(filterFormMobile, filterFormDesktop);
    applyFiltersAndRender();
    filterPanelMobile.classList.add('hidden');
  });

  // Filter toggle buttons
  filterBtnDesktop.addEventListener('click', () => {
    filterPanelDesktop.classList.toggle('hidden');
  });

  filterBtnMobile.addEventListener('click', () => {
    filterPanelMobile.classList.toggle('hidden');
  });

  // Sync filter forms values from source to target
  function syncFilterForms(sourceForm, targetForm) {
    Array.from(sourceForm.elements).forEach(el => {
      if (el.name && targetForm.elements[el.name]) {
        targetForm.elements[el.name].value = el.value;
      }
    });
  }

  // Search button handlers
  searchBtnDesktop.addEventListener('click', () => {
    applyFiltersAndRender();
  });
  searchBtnMobile.addEventListener('click', () => {
    applyFiltersAndRender();
    filterPanelMobile.classList.add('hidden');
  });
  searchInputDesktop.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      applyFiltersAndRender();
    }
  });
  searchInputMobile.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      applyFiltersAndRender();
      filterPanelMobile.classList.add('hidden');
    }
  });

  // Apply filters function also supports search text
  function applyFiltersAndRender() {
    const fDesktop = filterFormDesktop.elements;
    const fMobile = filterFormMobile.elements;

    const dateFrom = fDesktop.dateFrom.value || fMobile.dateFrom.value;
    const dateTo = fDesktop.dateTo.value || fMobile.dateTo.value;
    const priceOp = fDesktop.priceOp.value || fMobile.priceOp.value || '=';
    const priceVal = parseFloat(fDesktop.price.value || fMobile.price.value || '');
    const timeOp = fDesktop.timeOp.value || fMobile.timeOp.value || '=';
    const timeVal = parseInt(fDesktop.time.value || fMobile.time.value || '', 10);
    const fuelFilter = fDesktop.fuel.value || fMobile.fuel.value || '';
    const typeFilter = fDesktop.type.value || fMobile.type.value || '';
    const searchText = (searchInputDesktop.value || searchInputMobile.value).trim().toLowerCase();

    filteredServices = servicesData.filter(service => {
      // Date filter
      if (dateFrom && service.dateAdded < dateFrom) return false;
      if (dateTo && service.dateAdded > dateTo) return false;

      // Price filter
      if (!isNaN(priceVal)) {
        if (priceOp === '=' && service.price !== priceVal) return false;
        if (priceOp === '>=' && service.price < priceVal) return false;
        if (priceOp === '<=' && service.price > priceVal) return false;
      }

      // Time filter
      if (!isNaN(timeVal)) {
        if (timeOp === '=' && service.timeToComplete !== timeVal) return false;
        if (timeOp === '>=' && service.timeToComplete < timeVal) return false;
        if (timeOp === '<=' && service.timeToComplete > timeVal) return false;
      }

      // Fuel filter
      if (fuelFilter && service.fuel !== fuelFilter) return false;

      // Type filter
      if (typeFilter && service.type !== typeFilter) return false;

      // Search filter on brand, model, service name
      if (searchText) {
        const combined = (service.brand + ' ' + service.model + ' ' + service.serviceName).toLowerCase();
        if (!combined.includes(searchText)) return false;
      }
      return true;
    });

    selectedServiceIds.clear();
    renderAll();
  }

  // Initial render
  renderAll();
})();
</script>

</body>
</html>
